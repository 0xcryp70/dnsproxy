conf-dir=/etc/dnsmasq.d/,*.conf

# Performance optimizations
cache-size=100000                   # Increased for better hit rate
neg-ttl=3600                        # Cache negative responses
dns-forward-max=50000               # High concurrent query limit
query-port=0                        # Random source ports for security
min-cache-ttl=300                   # 5 minutes minimum cache
max-cache-ttl=86400                 # 24 hours maximum cache
max-ttl=86400                       # Limit maximum TTL
localise-queries                    # Return local addresses for local queries
no-ping                             # Skip ping check for DHCP
expand-hosts                        # Expand hostnames with domain
filterwin2k                         # Filter Windows noise queries
domain-needed                       # Don't forward plain names
bogus-priv                          # Reject private IP reverse lookups

# DNS upstream servers (optimized order)
no-resolv
server=1.1.1.1                    # Cloudflare primary
server=1.0.0.1                     # Cloudflare secondary (corrected)
server=8.8.8.8                     # Google primary
server=8.8.4.4                     # Google secondary (corrected)
all-servers                         # Query all servers in parallel
strict-order                        # Fallback order if all-servers fails

# Interface binding
interface=eth0
interface=lo
bind-interfaces
no-dhcp-interface=eth0              # Disable DHCP if not needed

# Performance tuning
read-ethers                         # Read /etc/ethers for static entries

# Logging - ERROR ONLY as requested
log-facility=/var/log/dnsmasq.log
log-async=500                # Asynchronous logging buffer
# Only log errors, warnings, and critical issues
# Remove or comment these lines to disable all logging:
#log-queries
# log-dhcp

# IPv6 optimizations
filter-AAAA                         # Uncomment if IPv6 not needed
# enable-ra                         # Enable if you need IPv6 RA

# Additional performance tweaks
pid-file=/var/run/dnsmasq.pid       # PID file location
user=dnsmasq                        # Run as non-root user
group=dnsmasq                       # Run as non-root group

# Memory and file limits
tftp-no-blocksize                   # Disable TFTP blocksize negotiation
dhcp-no-override                    # Prevent DHCP option override
